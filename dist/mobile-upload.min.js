/*! mobile-upload  v1.0.2
* author:tianxiangbing email:
* demo:http://www.lovewebgames.com/jsmodule/p_upload.html 
* git:  2015-04-07 */
!function(a,b){"function"==typeof define&&define.amd?define(["$"],b):"object"==typeof exports?module.exports=b():a.Mobile_upload=b(window.Zepto||window.jQuery||$)}(this,function(a){function b(){var a=Math.random().toString().replace(".","");this.id="upload_"+a,this.fileInput}return a.fn.Mobile_upload=function(c){var d=[];return a(this).each(function(){var e=new b,f=a.extend({target:a(this)},c);e.init(f),d.push(e)}),d},b.prototype={init:function(b){this.settings=a.extend({},this.settings,b),this.target=this.settings.target,this.createFile(),this.name=this.settings.name||"files",this.fileInput.css({opacity:"0",width:1}),this.settings.multiple&&this.fileInput.attr("multiple","multiple"),this.bindEvent()},touch:function(b,c){function d(a){return c.call(this,a)}var e;a(b).on("click",d),a(b).on("touchmove",function(){e=!0}).on("touchend",function(a){if(a.preventDefault(),!e){var b=c.call(this,a,"touch");b||(a.preventDefault(),a.stopPropagation())}e=!1})},createFile:function(){var b=this;b.fileInput&&b.fileInput.remove(),a(b.target).after('<input type="file" style="position:absolute;top:0;left:0;width:1px;height:1px;"  accept="image/*" id="'+b.id+'"/>'),b.fileInput=a("#"+b.id)},bindEvent:function(){var b=this;this.touch(a(this.target),function(){return a(b.fileInput).trigger("click"),!1}),b.bindFileEvent()},bindFileEvent:function(){var b=this;a(this.fileInput).change(function(c){for(var d=/^image\//i,e=c.target.files,f=e.length-1;f>=0;f--){var g=e[f];if(!d.test(g.type)){alert("不是图片文件");break}var h=new FileReader;b.settings.startUpload&&b.settings.startUpload(b.target),h.onload=function(){if(b.createFile(),b.bindFileEvent(),b.settings.imageReady&&b.settings.imageReady(b.target,this.result),b.settings.ajax){var c={};c[b.settings.ajax.name||"file"]=this.result,a.ajax({type:"post",url:b.settings.ajax.url,data:c,dataType:"json",success:function(a){b.settings.callback&&b.settings.callback(a)},complete:function(){b.settings.endUpload&&b.settings.endUpload(b.target)}})}else b.settings.callback&&b.settings.callback(this.result,g,b.name)},h.readAsDataURL(g)}})}},b});