/*! version:1.0.1  mobile-upload name:田想兵 qq:55342775 tianxiangbing http://www.lovewebgames.com/jsmodule/p_upload.html 2015-03-27*/
function Mobile_upload(){var a=Math.random().toString().replace(".","");this.id="upload_"+a,this.fileInput}Mobile_upload.prototype={init:function(a){this.settings=$.extend({},this.settings,a),this.target=this.settings.target,this.createFile(),this.name=this.settings.name||"files",this.fileInput.css({opacity:"0",width:1}),this.settings.multiple&&this.fileInput.attr("multiple","multiple"),this.bindEvent()},touch:function(a,b){var c;$(a).on("click",b),$(a).on("touchmove",function(){c=!0}).on("touchend",function(a){if(a.preventDefault(),!c){var d=b.call(this,a,"touch");d||(a.preventDefault(),a.stopPropagation())}c=!1})},createFile:function(){var a=this;a.fileInput&&a.fileInput.remove(),$(a.target).after('<input type="file" style="position:absolute;top:0;left:0;width:1px;height:1px;"  accept="image/*" id="'+a.id+'"/>'),a.fileInput=$("#"+a.id)},bindEvent:function(){var a=this;this.touch($(this.target),function(b,c){return console.log(c),$(a.fileInput).trigger("click"),!1}),a.bindFileEvent()},bindFileEvent:function(){var a=this;$(this.fileInput).change(function(b){for(var c=/^image\//i,d=b.target.files,e=d.length-1;e>=0;e--){var f=d[e];if(!c.test(f.type)){alert("不是图片文件");break}var g=new FileReader;a.settings.startUpload&&a.settings.startUpload(a.target),g.onload=function(){if(a.createFile(),a.bindFileEvent(),a.settings.imageReady&&a.settings.imageReady(a.target,this.result),a.settings.ajax){var b={};b[a.settings.ajax.name||"file"]=this.result,$.ajax({type:"post",url:a.settings.ajax.url,data:b,dataType:"json",success:function(b){a.settings.callback&&a.settings.callback(b)},complete:function(){a.settings.endUpload&&a.settings.endUpload(a.target)}})}else a.settings.callback&&a.settings.callback(this.result,f,a.name)},g.readAsDataURL(f)}})}},function(a){a.fn.Mobile_upload=function(b){var c=[];return a(this).each(function(){var d=new Mobile_upload,e=a.extend({target:a(this)},b);d.init(e),c.push(d)}),c}}($);